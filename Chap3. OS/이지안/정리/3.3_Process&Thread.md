# 프로세스와 스레드

## 3.3.1 프로세스와 컴파일 과정
> 프로세스 : 프로그램으로부터 인스턴스화된 것을 말함.
> 프로그램 : 컴파일러가 컴파일 과정을 거쳐 컴퓨터가 이해할 수 있는 기계어로 번역되어 실행할 수 있는 파일이 되는 것

### 1. 전처리
- 소스 코드의 주석을 제거 #include 등 헤더 파일을 병합
### 2. 컴파일러
- 오류 처리, 코드 최적화 작업을 하며 어셈블리어로 변환
### 3. 어셈블러
- 목적 코드로 변환 (리눅스에서의 .o 파일)
### 4. 링커
- 프로그램 내에 있는 라이브러리 함수 또는 다른 파일들과 목적코드를 결합하여 실행 파일을 만듦.
  4-1. `정적 라이브러리` : 라이브러리가 제공하는 모든 코드를 실행 파일에 넣는 방식
  - 외부 의존도가 낮고 코드 중복 등 메모리 효율성이 떨어짐.
  4-2. `동적 라이브러리` : 프로그램 실행 시 필요할 때만 DLL이라는 함수 정보를 통해 참조
  - 외부 의존도가 높고 메모리 효율성에서는 좋음.

## 3.3.2 프로세스의 상태
#### 생성 상태
- fork() 또는 exec() 함수를 통해 생성 (PCB 가 할당됨.)
#### 대기 상태
- CPU 소유권이 넘어오기를 기다리는 상태
#### 대기 중단 상태
- 메모리 부족으로 일시 중단된 상태
#### 실행 상태
- CPU 소유권과 메로리를 할당받고 인스트럭션을 수행 중인 상태
#### 중단 상태
- 어떤 이벤트가 발생한 이후기다리며 프로세스가 차단된 상태 (I/O 디바이스에 의한 인터럽트로 인해 발생하기도 함)
#### 일시 중단 상태
- 중단된 상태에서 프로세스가 실행되려고 했지만 메모리 부족으로 일시 중단된 상태
#### 종료 상태
- CPU 소유권과 메모리를 모두 놓고 가는 상태

## 3.3.3 프로세스의 메모리 구조
#### 스택
- 지역변수, 매개변수, 함수가 저장됨
- `컴파일 시에 크기가 결정`되고 동적으로 크기가 늘어날 수 있음.
#### 힙
- 동적할당할 때 사용, `런타임 시 크기가 결정`됨.
#### 데이터 영역
- 전역변수, 정적변수가 저장, 정적인 특징을 갖는 프로그램이 종료되면 사라지는 변수들이 들어가 있음.
#### 코드 영역
- 프로그램에 내장되어 있는 소스 코드가 들어가는 영역
- 기계어로 저장되어 있으며 정적인 특징을 가짐.

## 3.3.4 PCB
운영체제에서 프로세스에 대한 메타데이터를 저장한 데이터
- 프로세스 스케쥴링 상태, 프로세스 ID, 프로세스 권한, 프로그램 카운터, CPU 레지스터 ...

### 컨텍스트스위칭
PCB를 교환하는 과정
- 비용 : 캐시미스
- 스레드는 스택 영역을 제외한 모든 메모리를 공유하기 때문에 스레드 컨텍스트 스위칭의 경우 비용이 더 적고 시간도 더 적게 걸림.

## 3.3.5
### IPC
프로세스끼리 데이터를 주고받고 공유 데이터를 관리하는 메커니즘
(스레드보다는 속도가 떨어짐.)

### IPC의 종류
#### 공유 메모리
- 공유 버퍼를 생성하는 것
- 불필요한 데이터 복사의 오버헤드 x -> 가장 빠름.
- 같은 메모리 영역을 여러 프로세스가 공유하기 때문에 동기화가 필요
#### 파일
- 디스크에 저장된 파일을 기반으로 프로세스 간 통신
#### 소켓
- 동일한 컴퓨터의 다른 프로세스나 네트워크의 다른 컴픂터로 네트워크 인터페이스를 통해 데이터 전송
#### 익명 파이프
- 프로세스 간 FIFO 방식으로 파이프를 기반으로 데이터 주고 받음.
#### 명명된 파이프
#### 메시지 큐
- 메시지를 큐 형태로 관리

## 3.3.6 스레드와 멀티스레딩
### 스레드
프로세스의 실행 가능한 가장 작은 단위
한 프로세스 내의 실행 단위, 실행의 흐름
- 코드, 데이터, 힙은 공유

### 멀티스레딩
프로세스 내 작업을 여러 개의 스레드, 멀티스레드로 처리하는 기법

## 3.3.7 공유 자원과 임계 영역
### 공유 자원
- 각 프로세스, 스레드가 함께 접근할 수 있는 자원이나 변수
- `경쟁 상태` : 두 개 이상의 프로세스가 동시에 읽거나 쓰는 상황
### 임계 영역
- 공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 영역
> **해결방법**
> 뮤텍스 : 공유 자원을 사용하기 전에 설정하고 사용한 후에 해제하는 잠금
> 세마포어 : 일반화된 뮤텍스
> 바이너리 세마포어 : 
> 카운팅 세마포어 : 
> 모니터 : 공유 자원을 숨기고 해당 접근에 대해 인터페이스만 제공

## 3.3.8 교착 상태
### 교착 상태의 원인
1. 상호 배제 : 한 번에 여러 프로세스가 공유 자원을 사용할 수 없음.
2. 점유 대기 : 하나의 자원을 점유한 채로 다른 자원을 기다리고 있는 상태여야 함.
3. 비선점 : 강제로 뺏기가 불가능.
4. 환형 대기 : 하나의 프로세스가 다른 프로세스가 점유하고 있는 자원을 기다리고 있는데 이 형태가 원을 이뤄야 함.

### 교착상태 해결 방법
**은행원 알고리즘**
- 교착 상태 가능성이 없을 때만 자원 할당, 프로세스당 요청할 자원들의 최대치를 통해 자원 할당 가능 여부를 파악
1. 새로운 프로세스가 들어왔을 때, 리소스의 최대 수를 선언 